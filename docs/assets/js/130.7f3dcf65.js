(window.webpackJsonp=window.webpackJsonp||[]).push([[130],{214:function(t,a,s){"use strict";s.r(a);var r=s(0),e=Object(r.a)({},(function(){var t=this,a=t.$createElement,s=t._self._c||a;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("h1",{attrs:{id:"跨域"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#跨域","aria-hidden":"true"}},[t._v("#")]),t._v(" 跨域")]),t._v(" "),s("h2",{attrs:{id:"同源策略"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#同源策略","aria-hidden":"true"}},[t._v("#")]),t._v(" 同源策略")]),t._v(" "),s("p",[t._v("游览器的同源策略(浏览器对JavaScript施加的安全限制)(也就是说服务端不受限制)")]),t._v(" "),s("h3",{attrs:{id:"同源策略触发条件："}},[s("a",{staticClass:"header-anchor",attrs:{href:"#同源策略触发条件：","aria-hidden":"true"}},[t._v("#")]),t._v(" 同源策略触发条件：")]),t._v(" "),s("p",[s("strong",[t._v("协议、域名、端口任意一个不同，就产生跨域")])]),t._v(" "),s("h3",{attrs:{id:"同源策略限制条件"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#同源策略限制条件","aria-hidden":"true"}},[t._v("#")]),t._v(" 同源策略限制条件")]),t._v(" "),s("ul",[s("li",[t._v("DOM同源策略：")])]),t._v(" "),s("p",[t._v("禁止对不同源页面DOM进行操作。这里主要场景是iframe跨域的情况，不同域名的iframe是限制互相访问的。")]),t._v(" "),s("ul",[s("li",[t._v("XmlHttpRequest同源策略：")])]),t._v(" "),s("p",[t._v("禁止使用XHR对象向不同源的服务器地址发起HTTP请求。")]),t._v(" "),s("h3",{attrs:{id:"跨域限制的原因："}},[s("a",{staticClass:"header-anchor",attrs:{href:"#跨域限制的原因：","aria-hidden":"true"}},[t._v("#")]),t._v(" 跨域限制的原因：")]),t._v(" "),s("p",[t._v("1."),s("strong",[t._v("AJAX同源策略主要用来防止CSRF攻击")]),t._v("。")]),t._v(" "),s("p",[t._v("如果没有AJAX同源策略，相当危险，"),s("strong",[t._v("我们发起的每一次HTTP请求都会带上请求地址对应的cookie")]),t._v("，那么可以做如下攻击："),s("strong",[t._v("用户登录了自己的银行页面 http://mybank.com http://mybank.com向用户的cookie中添加用户标识。用户浏览了恶意页面 http://evil.com。执行了页面中的恶意AJAX请求代码。http://evil.com向http://mybank.com发起AJAX HTTP请求，请求会默认把http://mybank.com对应cookie也同时发送过去。银行页面从发送的cookie中提取用户标识，验证用户无误，response中返回请求数据。此时数据就泄露了")]),t._v("。而且由于Ajax在后台执行，用户无法感知这一过程。")]),t._v(" "),s("p",[t._v("2.DOM同源策略也一样，如果iframe之间可以跨域访问，可以这样攻击")]),t._v(" "),s("p",[t._v("做一个假网站，"),s("strong",[t._v("里面用iframe嵌套一个银行网站 http://mybank.com。把iframe宽高啥的调整到页面全部，这样用户进来除了域名，别的部分和银行的网站没有任何差别。这时如果用户输入账号密码，我们的主网站可以跨域访问到http://mybank.com的dom节点，就可以拿到用户的输入了")]),t._v("，那么就完成了一次攻击。")]),t._v(" "),s("h2",{attrs:{id:"解决方法"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#解决方法","aria-hidden":"true"}},[t._v("#")]),t._v(" 解决方法")]),t._v(" "),s("h3",{attrs:{id:"ajax跨域"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#ajax跨域","aria-hidden":"true"}},[t._v("#")]),t._v(" ajax跨域")]),t._v(" "),s("h4",{attrs:{id:"浏览器"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#浏览器","aria-hidden":"true"}},[t._v("#")]),t._v(" 浏览器")]),t._v(" "),s("ul",[s("li",[t._v("jsonp")])]),t._v(" "),s("p",[t._v("由回调函数和数据")]),t._v(" "),s("div",{staticClass:"language-javascript extra-class"},[s("pre",{pre:!0,attrs:{class:"language-javascript"}},[s("code",[s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("script type"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"text/javascript"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("dosomething")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("jsondata")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//处理获得的json数据")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("script"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("script src"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"http://example.com/data.php?callback=dosomething"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("script"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\n")])])]),s("h4",{attrs:{id:"协议"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#协议","aria-hidden":"true"}},[t._v("#")]),t._v(" 协议")]),t._v(" "),s("ul",[s("li",[t._v("websocket")])]),t._v(" "),s("div",{staticClass:"language-php extra-class"},[s("pre",{pre:!0,attrs:{class:"language-php"}},[s("code",[s("span",{pre:!0,attrs:{class:"token php language-php"}},[s("span",{pre:!0,attrs:{class:"token delimiter important"}},[t._v("<?php")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$callback")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$_GET")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token single-quoted-string string"}},[t._v("'callback'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//得到回调函数名")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$data")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("array")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token single-quoted-string string"}},[t._v("'a'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),s("span",{pre:!0,attrs:{class:"token single-quoted-string string"}},[t._v("'b'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),s("span",{pre:!0,attrs:{class:"token single-quoted-string string"}},[t._v("'c'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//要返回的数据")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("echo")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$callback")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token single-quoted-string string"}},[t._v("'('")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("json_encode")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$data")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token single-quoted-string string"}},[t._v("')'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//输出")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token delimiter important"}},[t._v("?>")])]),t._v("\n")])])]),s("p",[t._v("缺点：只支持GET请求")]),t._v(" "),s("h4",{attrs:{id:"中间代理"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#中间代理","aria-hidden":"true"}},[t._v("#")]),t._v(" 中间代理")]),t._v(" "),s("ul",[s("li",[s("p",[t._v("正向代理服务器")])]),t._v(" "),s("li",[s("p",[t._v("nginx")])])]),t._v(" "),s("h4",{attrs:{id:"服务端"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#服务端","aria-hidden":"true"}},[t._v("#")]),t._v(" 服务端")]),t._v(" "),s("h3",{attrs:{id:"dom跨域"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#dom跨域","aria-hidden":"true"}},[t._v("#")]),t._v(" DOM跨域")]),t._v(" "),s("ul",[s("li",[t._v("H5 postMessage方法")])]),t._v(" "),s("div",{staticClass:"language-javascript extra-class"},[s("pre",{pre:!0,attrs:{class:"language-javascript"}},[s("code",[t._v("window"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("postMessage")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("message"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("targetOrigin"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" \n")])])])])}),[],!1,null,null,null);a.default=e.exports}}]);