import{_ as n,c as s,o as a,a as t}from"./app.a3c81315.js";const g='{"title":"eventloop","description":"","frontmatter":{},"headers":[{"level":2,"title":"task","slug":"task"},{"level":2,"title":"microtasks","slug":"microtasks"},{"level":2,"title":"\u91CD\u8981\u6539\u9769\u70B9","slug":"\u91CD\u8981\u6539\u9769\u70B9"},{"level":3,"title":"Node11\u6539\u53D8\u5FAA\u73AF\u7B56\u7565","slug":"node11\u6539\u53D8\u5FAA\u73AF\u7B56\u7565"},{"level":3,"title":"\u8C37\u6B4C\u63D0\u6848\u6539\u53D8await\u89C4\u8303","slug":"\u8C37\u6B4C\u63D0\u6848\u6539\u53D8await\u89C4\u8303"},{"level":2,"title":"\u5E38\u89C1\u95EE\u9898","slug":"\u5E38\u89C1\u95EE\u9898"},{"level":2,"title":"\u5E38\u89C1\u5206\u6790","slug":"\u5E38\u89C1\u5206\u6790"},{"level":2,"title":"\u7279\u6B8A\u4F8B\u5B50","slug":"\u7279\u6B8A\u4F8B\u5B50"}],"relativePath":"\u524D\u7AEF/\u524D\u7AEF\u57FA\u7840/browser/\u6E32\u67D3\u673A\u5236/eventloop.md"}',p={},o=t(`<h1 id="eventloop" tabindex="-1">eventloop <a class="header-anchor" href="#eventloop" aria-hidden="true">#</a></h1><p>eventloop\u610F\u4E3A\u4E8B\u4EF6\u5FAA\u73AF\uFF0C\u662Fjs\u57FA\u4E8E\u5355\u7EBF\u7A0B\u7684\u4F18\u5316\u624B\u6BB5\uFF0C\u5176\u4E2D\u6709\u4EE5\u4E0B\u4E24\u4E2A\u91CD\u8981\u6982\u5FF5<code>task</code>\u3001<code>microtasks</code></p><h2 id="task" tabindex="-1">task <a class="header-anchor" href="#task" aria-hidden="true">#</a></h2><h2 id="microtasks" tabindex="-1">microtasks <a class="header-anchor" href="#microtasks" aria-hidden="true">#</a></h2><h2 id="\u91CD\u8981\u6539\u9769\u70B9" tabindex="-1">\u91CD\u8981\u6539\u9769\u70B9 <a class="header-anchor" href="#\u91CD\u8981\u6539\u9769\u70B9" aria-hidden="true">#</a></h2><h3 id="node11\u6539\u53D8\u5FAA\u73AF\u7B56\u7565" tabindex="-1">Node11\u6539\u53D8\u5FAA\u73AF\u7B56\u7565 <a class="header-anchor" href="#node11\u6539\u53D8\u5FAA\u73AF\u7B56\u7565" aria-hidden="true">#</a></h3><p>Execution of a Job <strong>can be</strong> initiated only when there is no running execution context and the execution context stack is empty\u2026</p><p>\u2014\u2014 <a href="https://www.ecma-international.org/ecma-262/6.0/#sec-jobs-and-job-queues" target="_blank" rel="noopener noreferrer">ECMAScript: Jobs and Job Queues</a></p><p>ECMA\u89C4\u8303\u89C4\u5B9A\uFF0C\u5FAE\u4EFB\u52A1\u5C3D\u53EF\u80FD\u8981\u5728\u5F53\u524D\u8C03\u7528\u6808\u4E3A\u7A7A\u7684\u65F6\u5019\u6267\u884C\uFF0C\u6240\u4EE5NodeV11\u7248\u672C\u4E4B\u524D\uFF0C\u662F\u6267\u884C\u5B8C\u6240\u6709\u7684timer\u624D\u6267\u884C\u5FAE\u4EFB\u52A1\uFF0C\u540E\u6765\u4E0E\u6D4F\u89C8\u5668\u7EDF\u4E00\uFF0C\u6267\u884C\u4E00\u6B21\u4EFB\u52A1\u5C31\u68C0\u67E5\u5FAE\u4EFB\u52A1\u961F\u5217</p><div class="language-js"><pre><code><span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;timer1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    Promise<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;promise1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;timer2&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    Promise<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;promise2&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><strong>node10</strong></p><div class="language-js"><pre><code>timer1<span class="token punctuation">;</span>
timer2<span class="token punctuation">;</span>
promise1<span class="token punctuation">;</span>
promise2<span class="token punctuation">;</span>
</code></pre></div><p><strong>node11</strong></p><div class="language-js"><pre><code>timer1<span class="token punctuation">;</span>
promise1<span class="token punctuation">;</span>
timer2<span class="token punctuation">;</span>
promise2<span class="token punctuation">;</span>
</code></pre></div><p><a href="https://blog.fundebug.com/2019/04/02/nodejs-event-loop-has-changed/" target="_blank" rel="noopener noreferrer">\u76F8\u5173\u6587\u7AE0</a></p><h3 id="\u8C37\u6B4C\u63D0\u6848\u6539\u53D8await\u89C4\u8303" tabindex="-1">\u8C37\u6B4C\u63D0\u6848\u6539\u53D8await\u89C4\u8303 <a class="header-anchor" href="#\u8C37\u6B4C\u63D0\u6848\u6539\u53D8await\u89C4\u8303" aria-hidden="true">#</a></h3><p><a href="https://github.com/tc39/ecma262/pull/1250" target="_blank" rel="noopener noreferrer">\u4F7F\u7528promise.resolve\u4EE3\u66FFnewPromise\u4EE5\u63D0\u5347await\u6027\u80FD</a></p><p><a href="https://mp.weixin.qq.com/s/E-HKpdpV_rSX21kHHq-Fxg" target="_blank" rel="noopener noreferrer">\u8BE6\u7EC6\u573A\u666F\u5206\u6790</a></p><p><a href="https://segmentfault.com/a/1190000017954500" target="_blank" rel="noopener noreferrer">\u8F85\u52A9\u7406\u89E3\u8D44\u6599</a></p><h2 id="\u5E38\u89C1\u95EE\u9898" tabindex="-1">\u5E38\u89C1\u95EE\u9898 <a class="header-anchor" href="#\u5E38\u89C1\u95EE\u9898" aria-hidden="true">#</a></h2><ul><li><p>[ ] <a href="https://html.spec.whatwg.org/#event-loop" target="_blank" rel="noopener noreferrer">eventloop</a></p><ul><li><p>[ ] \u4EFB\u52A1\u961F\u5217<code>eventloop</code></p><ul><li><p>[x] \u7C7B\u522B</p><ul><li><p>[x] \u5B8F\u4EFB\u52A1<code>task</code></p></li><li><p>[x] \u5FAE\u4EFB\u52A1<code>microtask</code></p></li></ul></li><li><p>[x] \u8FD0\u884C\u8FC7\u7A0B - <strong>\u6BCF\u8FD0\u884C\u4E00\u6B21\u5B8F\u4EFB\u52A1\u5C31\u6E05\u7A7A\u5FAE\u4EFB\u52A1\u961F\u5217,\u63A5\u4E0B\u6765\u53EF\u80FD\u4F1A\u6E32\u67D3UI</strong></p></li><li><p>[x] \u5E94\u7528</p><ul><li>[x] \u5408\u5E76\u6279\u91CF\u4EFB\u52A1 - <strong>Vue\u7684nextTick</strong></li><li>[x] \u4FDD\u6301\u4EFB\u52A1\u987A\u5E8F\u7684\u4E00\u81F4\u6027</li></ul></li><li><p>[x] \u5185\u7F6E\u65B9\u6CD5</p><ul><li><p>[x] \u5FAE\u4EFB\u52A1</p><ul><li>[x] <code>queueMicrotask</code></li></ul></li><li><p>[x] \u4F18\u5316</p><ul><li><p>[x] <code>requestAnimationFrame</code></p></li><li><p>[x] <code>requestIdleCallback</code></p></li></ul></li></ul></li></ul></li></ul></li></ul><h2 id="\u5E38\u89C1\u5206\u6790" tabindex="-1">\u5E38\u89C1\u5206\u6790 <a class="header-anchor" href="#\u5E38\u89C1\u5206\u6790" aria-hidden="true">#</a></h2><p><a href="https://juejin.im/post/6844903808200343559" target="_blank" rel="noopener noreferrer">https://juejin.im/post/6844903808200343559</a></p><p>promise\u987A\u5E8F\u95EE\u9898</p><p>Promise.resolve\u5BF9\u6BD4new Promise(r =&gt; r(v))</p><h2 id="\u7279\u6B8A\u4F8B\u5B50" tabindex="-1">\u7279\u6B8A\u4F8B\u5B50 <a class="header-anchor" href="#\u7279\u6B8A\u4F8B\u5B50" aria-hidden="true">#</a></h2><div class="language-html"><pre><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>outer<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>inner<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><div class="language-js"><pre><code><span class="token comment">// Let&#39;s get hold of those elements</span>
<span class="token keyword">var</span> outer <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">&#39;.outer&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> inner <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">&#39;.inner&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Let&#39;s listen for attribute changes on the</span>
<span class="token comment">// outer element</span>
<span class="token keyword">new</span> <span class="token class-name">MutationObserver</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;mutate&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">observe</span><span class="token punctuation">(</span>outer<span class="token punctuation">,</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">attributes</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Here&#39;s a click listener\u2026</span>
<span class="token keyword">function</span> <span class="token function">onClick</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;click&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;timeout&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  Promise<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;promise&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  outer<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">&#39;data-random&#39;</span><span class="token punctuation">,</span> Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// \u2026which we&#39;ll attach to both elements</span>
inner<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&#39;click&#39;</span><span class="token punctuation">,</span> onClick<span class="token punctuation">)</span><span class="token punctuation">;</span>
outer<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&#39;click&#39;</span><span class="token punctuation">,</span> onClick<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>\u731C\u6D4B\u987A\u5E8F\uFF0CUI\u89E6\u53D1click\u548Cjs\u89E6\u53D1click\u7ED3\u679C\u4E0D\u4E00\u81F4\uFF0C<a href="https://jakearchibald.com/2015/tasks-microtasks-queues-and-schedules/" target="_blank" rel="noopener noreferrer">\u5206\u6790</a></p>`,29),e=[o];function c(u,l,i,k,r,d){return a(),s("div",null,e)}var m=n(p,[["render",c]]);export{g as __pageData,m as default};
