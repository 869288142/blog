<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>再解生命周期</title>
    <meta name="description" content="">
    
    
    <link rel="preload" href="/knowledge-structure/assets/css/0.styles.71d6d626.css" as="style"><link rel="preload" href="/knowledge-structure/assets/js/app.4b2130d8.js" as="script"><link rel="preload" href="/knowledge-structure/assets/js/95.c251cdc2.js" as="script"><link rel="prefetch" href="/knowledge-structure/assets/js/10.7f161f5b.js"><link rel="prefetch" href="/knowledge-structure/assets/js/100.6d47efb0.js"><link rel="prefetch" href="/knowledge-structure/assets/js/101.ebdb8e4c.js"><link rel="prefetch" href="/knowledge-structure/assets/js/102.54eaa358.js"><link rel="prefetch" href="/knowledge-structure/assets/js/103.7bcc69d9.js"><link rel="prefetch" href="/knowledge-structure/assets/js/104.7477e5e0.js"><link rel="prefetch" href="/knowledge-structure/assets/js/105.eea5a497.js"><link rel="prefetch" href="/knowledge-structure/assets/js/106.4d47c726.js"><link rel="prefetch" href="/knowledge-structure/assets/js/107.60f5c149.js"><link rel="prefetch" href="/knowledge-structure/assets/js/108.f32a5ab7.js"><link rel="prefetch" href="/knowledge-structure/assets/js/109.fcd4f6a6.js"><link rel="prefetch" href="/knowledge-structure/assets/js/11.26b90d7f.js"><link rel="prefetch" href="/knowledge-structure/assets/js/110.fe119a92.js"><link rel="prefetch" href="/knowledge-structure/assets/js/12.0a4541bd.js"><link rel="prefetch" href="/knowledge-structure/assets/js/13.9cf55a1c.js"><link rel="prefetch" href="/knowledge-structure/assets/js/14.2fc51f88.js"><link rel="prefetch" href="/knowledge-structure/assets/js/15.28fb6b1f.js"><link rel="prefetch" href="/knowledge-structure/assets/js/16.1e7bfd00.js"><link rel="prefetch" href="/knowledge-structure/assets/js/17.fec58d82.js"><link rel="prefetch" href="/knowledge-structure/assets/js/18.42e85660.js"><link rel="prefetch" href="/knowledge-structure/assets/js/19.f57ceefb.js"><link rel="prefetch" href="/knowledge-structure/assets/js/2.aac8a8b3.js"><link rel="prefetch" href="/knowledge-structure/assets/js/20.11ee5013.js"><link rel="prefetch" href="/knowledge-structure/assets/js/21.65faa122.js"><link rel="prefetch" href="/knowledge-structure/assets/js/22.722dd339.js"><link rel="prefetch" href="/knowledge-structure/assets/js/23.a0e413df.js"><link rel="prefetch" href="/knowledge-structure/assets/js/24.428f45e4.js"><link rel="prefetch" href="/knowledge-structure/assets/js/25.b437b0a5.js"><link rel="prefetch" href="/knowledge-structure/assets/js/26.f16cb666.js"><link rel="prefetch" href="/knowledge-structure/assets/js/27.d02609ae.js"><link rel="prefetch" href="/knowledge-structure/assets/js/28.339b223d.js"><link rel="prefetch" href="/knowledge-structure/assets/js/29.63a29059.js"><link rel="prefetch" href="/knowledge-structure/assets/js/3.27e1a324.js"><link rel="prefetch" href="/knowledge-structure/assets/js/30.b919bada.js"><link rel="prefetch" href="/knowledge-structure/assets/js/31.1ec66301.js"><link rel="prefetch" href="/knowledge-structure/assets/js/32.f67782f4.js"><link rel="prefetch" href="/knowledge-structure/assets/js/33.897f04ba.js"><link rel="prefetch" href="/knowledge-structure/assets/js/34.c6ba6973.js"><link rel="prefetch" href="/knowledge-structure/assets/js/35.f036bb44.js"><link rel="prefetch" href="/knowledge-structure/assets/js/36.f1ba9a35.js"><link rel="prefetch" href="/knowledge-structure/assets/js/37.278ef401.js"><link rel="prefetch" href="/knowledge-structure/assets/js/38.249c5bf9.js"><link rel="prefetch" href="/knowledge-structure/assets/js/39.16085fe7.js"><link rel="prefetch" href="/knowledge-structure/assets/js/4.8e3c0542.js"><link rel="prefetch" href="/knowledge-structure/assets/js/40.be11c88d.js"><link rel="prefetch" href="/knowledge-structure/assets/js/41.ca1bc82c.js"><link rel="prefetch" href="/knowledge-structure/assets/js/42.14239910.js"><link rel="prefetch" href="/knowledge-structure/assets/js/43.6ccb756d.js"><link rel="prefetch" href="/knowledge-structure/assets/js/44.58feacb1.js"><link rel="prefetch" href="/knowledge-structure/assets/js/45.ca2d9670.js"><link rel="prefetch" href="/knowledge-structure/assets/js/46.53e5fd08.js"><link rel="prefetch" href="/knowledge-structure/assets/js/47.bca8d29a.js"><link rel="prefetch" href="/knowledge-structure/assets/js/48.71196910.js"><link rel="prefetch" href="/knowledge-structure/assets/js/49.e5374bff.js"><link rel="prefetch" href="/knowledge-structure/assets/js/5.f0eaf542.js"><link rel="prefetch" href="/knowledge-structure/assets/js/50.abf1fc8a.js"><link rel="prefetch" href="/knowledge-structure/assets/js/51.40edab6b.js"><link rel="prefetch" href="/knowledge-structure/assets/js/52.a1de2f97.js"><link rel="prefetch" href="/knowledge-structure/assets/js/53.4781d531.js"><link rel="prefetch" href="/knowledge-structure/assets/js/54.9cecb7d1.js"><link rel="prefetch" href="/knowledge-structure/assets/js/55.cc7ad624.js"><link rel="prefetch" href="/knowledge-structure/assets/js/56.a5c99486.js"><link rel="prefetch" href="/knowledge-structure/assets/js/57.c9b37a61.js"><link rel="prefetch" href="/knowledge-structure/assets/js/58.5a5297e9.js"><link rel="prefetch" href="/knowledge-structure/assets/js/59.fb6771db.js"><link rel="prefetch" href="/knowledge-structure/assets/js/6.760fd5f1.js"><link rel="prefetch" href="/knowledge-structure/assets/js/60.c020718b.js"><link rel="prefetch" href="/knowledge-structure/assets/js/61.88612bf1.js"><link rel="prefetch" href="/knowledge-structure/assets/js/62.558e21d4.js"><link rel="prefetch" href="/knowledge-structure/assets/js/63.8b044032.js"><link rel="prefetch" href="/knowledge-structure/assets/js/64.225c400a.js"><link rel="prefetch" href="/knowledge-structure/assets/js/65.1b75c03b.js"><link rel="prefetch" href="/knowledge-structure/assets/js/66.25c0c232.js"><link rel="prefetch" href="/knowledge-structure/assets/js/67.79c2bcd5.js"><link rel="prefetch" href="/knowledge-structure/assets/js/68.2635d060.js"><link rel="prefetch" href="/knowledge-structure/assets/js/69.5154a63b.js"><link rel="prefetch" href="/knowledge-structure/assets/js/7.0f3e00b3.js"><link rel="prefetch" href="/knowledge-structure/assets/js/70.6ca79c8c.js"><link rel="prefetch" href="/knowledge-structure/assets/js/71.265601c3.js"><link rel="prefetch" href="/knowledge-structure/assets/js/72.882e64df.js"><link rel="prefetch" href="/knowledge-structure/assets/js/73.211bcfb5.js"><link rel="prefetch" href="/knowledge-structure/assets/js/74.a4bd8335.js"><link rel="prefetch" href="/knowledge-structure/assets/js/75.2e4847a4.js"><link rel="prefetch" href="/knowledge-structure/assets/js/76.ef0fdddc.js"><link rel="prefetch" href="/knowledge-structure/assets/js/77.bceb81fc.js"><link rel="prefetch" href="/knowledge-structure/assets/js/78.0f4ec860.js"><link rel="prefetch" href="/knowledge-structure/assets/js/79.e4fba625.js"><link rel="prefetch" href="/knowledge-structure/assets/js/8.d4889a22.js"><link rel="prefetch" href="/knowledge-structure/assets/js/80.359fb08b.js"><link rel="prefetch" href="/knowledge-structure/assets/js/81.389ff9e4.js"><link rel="prefetch" href="/knowledge-structure/assets/js/82.e3e4588b.js"><link rel="prefetch" href="/knowledge-structure/assets/js/83.1d111b2a.js"><link rel="prefetch" href="/knowledge-structure/assets/js/84.2d5a7830.js"><link rel="prefetch" href="/knowledge-structure/assets/js/85.8a830be0.js"><link rel="prefetch" href="/knowledge-structure/assets/js/86.46227bfa.js"><link rel="prefetch" href="/knowledge-structure/assets/js/87.d4e817d2.js"><link rel="prefetch" href="/knowledge-structure/assets/js/88.ba8837f5.js"><link rel="prefetch" href="/knowledge-structure/assets/js/89.03773d73.js"><link rel="prefetch" href="/knowledge-structure/assets/js/9.10839a46.js"><link rel="prefetch" href="/knowledge-structure/assets/js/90.2cf91e02.js"><link rel="prefetch" href="/knowledge-structure/assets/js/91.fe3cae69.js"><link rel="prefetch" href="/knowledge-structure/assets/js/92.4f008da8.js"><link rel="prefetch" href="/knowledge-structure/assets/js/93.5826ea12.js"><link rel="prefetch" href="/knowledge-structure/assets/js/94.ab8dbf4e.js"><link rel="prefetch" href="/knowledge-structure/assets/js/96.5c39d0e8.js"><link rel="prefetch" href="/knowledge-structure/assets/js/97.63a06a3e.js"><link rel="prefetch" href="/knowledge-structure/assets/js/98.e2df2bfc.js"><link rel="prefetch" href="/knowledge-structure/assets/js/99.456acdf4.js">
    <link rel="stylesheet" href="/knowledge-structure/assets/css/0.styles.71d6d626.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/knowledge-structure/" class="home-link router-link-active"></a> <div class="links" style="max-width:nullpx;"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">前端</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/knowledge-structure/browser/" class="nav-link">browser</a></li><li class="dropdown-item"><!----> <a href="/knowledge-structure/HTTP/" class="nav-link">HTTP</a></li><li class="dropdown-item"><!----> <a href="/knowledge-structure/HTML/" class="nav-link">HTML</a></li><li class="dropdown-item"><!----> <a href="/knowledge-structure/CSS/" class="nav-link">CSS</a></li><li class="dropdown-item"><!----> <a href="/knowledge-structure/JS/" class="nav-link">JS</a></li><li class="dropdown-item"><!----> <a href="/knowledge-structure/Vue/" class="nav-link router-link-active">Vue</a></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar"><nav class="nav-links"><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">前端</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/knowledge-structure/browser/" class="nav-link">browser</a></li><li class="dropdown-item"><!----> <a href="/knowledge-structure/HTTP/" class="nav-link">HTTP</a></li><li class="dropdown-item"><!----> <a href="/knowledge-structure/HTML/" class="nav-link">HTML</a></li><li class="dropdown-item"><!----> <a href="/knowledge-structure/CSS/" class="nav-link">CSS</a></li><li class="dropdown-item"><!----> <a href="/knowledge-structure/JS/" class="nav-link">JS</a></li><li class="dropdown-item"><!----> <a href="/knowledge-structure/Vue/" class="nav-link router-link-active">Vue</a></li></ul></div></div> <!----></nav>  <ul class="sidebar-links"><li><div class="sidebar-group first collapsable"><p class="sidebar-heading"><span>思想</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>原理</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>组件</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading open"><span>生命周期</span> <span class="arrow down"></span></p> <ul class="sidebar-group-items"><li><a href="/knowledge-structure/Vue/生命周期/vue生命周期.html" class="sidebar-link">生命周期</a></li><li><a href="/knowledge-structure/Vue/生命周期/再解生命周期.html" class="active sidebar-link">再解生命周期</a></li></ul></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>状态树</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>路由</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>脚手架</span> <span class="arrow right"></span></p> <!----></div></li></ul> </div> <div class="page"> <div class="content"><h1 id="再解生命周期"><a href="#再解生命周期" aria-hidden="true" class="header-anchor">#</a> 再解生命周期</h1> <p>深入到源码和 eventloop 了解生命周期</p> <p>生命周期的本质是程序执行到某个点，同步执行某个函数，此时称为生命周期钩子</p> <p>callHook(vm, 'beforeCreate');</p> <p>new Vue()</p> <p>Vue 构造函数</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">Vue</span> <span class="token punctuation">(</span><span class="token parameter">options</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
 <span class="token keyword">if</span> <span class="token punctuation">(</span>process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">NODE_ENV</span> <span class="token operator">!==</span> <span class="token string">'production'</span> <span class="token operator">&amp;&amp;</span>
   <span class="token operator">!</span><span class="token punctuation">(</span><span class="token keyword">this</span> <span class="token keyword">instanceof</span> <span class="token class-name">Vue</span><span class="token punctuation">)</span>
 <span class="token punctuation">)</span> <span class="token punctuation">{</span>
   <span class="token function">warn</span><span class="token punctuation">(</span><span class="token string">'Vue is a constructor and should be called with the `new` keyword'</span><span class="token punctuation">)</span>
 <span class="token punctuation">}</span>
 <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">_init</span><span class="token punctuation">(</span>options<span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token class-name">通过检测生成this的原型是否为Vue</span><span class="token punctuation">.</span>prototype<span class="token punctuation">,</span>对非<span class="token keyword">new</span><span class="token function">调用Vue进行警告，生产环境也会提示警告</span><span class="token punctuation">(</span>暂时忽略这个原理<span class="token punctuation">)</span>，然后调用_init方法
</code></pre></div><p>init Init Events &amp; LifeCycle 关键代码 初始化事件和生命周期</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token function">initLifecycle</span><span class="token punctuation">(</span>vm<span class="token punctuation">)</span>
<span class="token function">initEvents</span><span class="token punctuation">(</span>vm<span class="token punctuation">)</span>
<span class="token function">initRender</span><span class="token punctuation">(</span>vm<span class="token punctuation">)</span>
<span class="token function">callHook</span><span class="token punctuation">(</span>vm<span class="token punctuation">,</span> <span class="token string">'beforeCreate'</span><span class="token punctuation">)</span>
<span class="token function">initInjections</span><span class="token punctuation">(</span>vm<span class="token punctuation">)</span> <span class="token comment">// resolve injections before data/props</span>
<span class="token function">initState</span><span class="token punctuation">(</span>vm<span class="token punctuation">)</span>
<span class="token function">initProvide</span><span class="token punctuation">(</span>vm<span class="token punctuation">)</span> <span class="token comment">// resolve provide after data/props</span>
<span class="token function">callHook</span><span class="token punctuation">(</span>vm<span class="token punctuation">,</span> <span class="token string">'created'</span><span class="token punctuation">)</span>
</code></pre></div><p>initLifecycle</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">initLifecycle</span><span class="token punctuation">(</span><span class="token parameter">vm<span class="token punctuation">:</span> Component</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> options <span class="token operator">=</span> vm<span class="token punctuation">.</span>$options
  <span class="token comment">/**
   * 这里判断是否存在父示例，如果存在，则通过 while 循环，建立所有组建的父子关系
   */</span>
  <span class="token keyword">let</span> parent <span class="token operator">=</span> options<span class="token punctuation">.</span>parent
  <span class="token keyword">if</span> <span class="token punctuation">(</span>parent <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>options<span class="token punctuation">.</span>abstract<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">while</span> <span class="token punctuation">(</span>parent<span class="token punctuation">.</span>$options<span class="token punctuation">.</span>abstract <span class="token operator">&amp;&amp;</span> parent<span class="token punctuation">.</span>$parent<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      parent <span class="token operator">=</span> parent<span class="token punctuation">.</span>$parent
    <span class="token punctuation">}</span>
    parent<span class="token punctuation">.</span>$children<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>vm<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token comment">/**
   * 为组件实例挂载相应属性，并初始化
   */</span>
  vm<span class="token punctuation">.</span>$parent <span class="token operator">=</span> parent
  vm<span class="token punctuation">.</span>$root <span class="token operator">=</span> parent <span class="token operator">?</span> parent<span class="token punctuation">.</span>$root <span class="token punctuation">:</span> vm

  vm<span class="token punctuation">.</span>$children <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
  vm<span class="token punctuation">.</span>$refs <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>

  vm<span class="token punctuation">.</span>_watcher <span class="token operator">=</span> <span class="token keyword">null</span>
  vm<span class="token punctuation">.</span>_inactive <span class="token operator">=</span> <span class="token keyword">null</span>
  vm<span class="token punctuation">.</span>_directInactive <span class="token operator">=</span> <span class="token boolean">false</span>
  vm<span class="token punctuation">.</span>_isMounted <span class="token operator">=</span> <span class="token boolean">false</span>
  vm<span class="token punctuation">.</span>_isDestroyed <span class="token operator">=</span> <span class="token boolean">false</span>
  vm<span class="token punctuation">.</span>_isBeingDestroyed <span class="token operator">=</span> <span class="token boolean">false</span>
<span class="token punctuation">}</span>
</code></pre></div><p>initEvents</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">initEvents</span><span class="token punctuation">(</span><span class="token parameter">vm<span class="token punctuation">:</span> Component</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">/**
   * 创建事件对象，用于存储事件
   */</span>
  vm<span class="token punctuation">.</span>_events <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span>
  <span class="token comment">/**
   * 这里应该是系统事件标识位
   */</span>
  vm<span class="token punctuation">.</span>_hasHookEvent <span class="token operator">=</span> <span class="token boolean">false</span>
  <span class="token comment">// init parent attached events</span>
  <span class="token comment">// _parentListeners其实是父组件模板中写的v-on</span>
  <span class="token comment">// 所以下面这段就是将父组件模板中注册的事件放到当前组件实例的listeners里面</span>
  <span class="token keyword">const</span> listeners <span class="token operator">=</span> vm<span class="token punctuation">.</span>$options<span class="token punctuation">.</span>_parentListeners
  <span class="token keyword">if</span> <span class="token punctuation">(</span>listeners<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">updateComponentListeners</span><span class="token punctuation">(</span>vm<span class="token punctuation">,</span> listeners<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>initRender 忽略先</p> <p><strong>callHook</strong></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">callHook</span><span class="token punctuation">(</span><span class="token parameter">vm<span class="token punctuation">:</span> Component<span class="token punctuation">,</span> hook<span class="token punctuation">:</span> string</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> handlers <span class="token operator">=</span> vm<span class="token punctuation">.</span>$options<span class="token punctuation">[</span>hook<span class="token punctuation">]</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>handlers<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> j <span class="token operator">=</span> handlers<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i <span class="token operator">&lt;</span> j<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">try</span> <span class="token punctuation">{</span>
        handlers<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>vm<span class="token punctuation">)</span>
      <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">handleError</span><span class="token punctuation">(</span>e<span class="token punctuation">,</span> vm<span class="token punctuation">,</span> <span class="token template-string"><span class="token string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>hook<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> hook`</span></span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>vm<span class="token punctuation">.</span>_hasHookEvent<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    vm<span class="token punctuation">.</span><span class="token function">$emit</span><span class="token punctuation">(</span><span class="token string">'hook:'</span> <span class="token operator">+</span> hook<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p><strong>callHook(vm, 'beforeCreate')</strong></p> <p>init injections &amp; reactivity 初始化注入和响应式数据</p> <p>initState</p> <div class="language-js extra-class"><pre class="language-js"><code>初始化 props  data computed  watch  methods

<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">initState</span> <span class="token punctuation">(</span><span class="token parameter">vm<span class="token punctuation">:</span> Component</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  vm<span class="token punctuation">.</span>_watchers <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
  <span class="token keyword">const</span> opts <span class="token operator">=</span> vm<span class="token punctuation">.</span>$options
  <span class="token keyword">if</span> <span class="token punctuation">(</span>opts<span class="token punctuation">.</span>props<span class="token punctuation">)</span> <span class="token function">initProps</span><span class="token punctuation">(</span>vm<span class="token punctuation">,</span> opts<span class="token punctuation">.</span>props<span class="token punctuation">)</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>opts<span class="token punctuation">.</span>methods<span class="token punctuation">)</span> <span class="token function">initMethods</span><span class="token punctuation">(</span>vm<span class="token punctuation">,</span> opts<span class="token punctuation">.</span>methods<span class="token punctuation">)</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>opts<span class="token punctuation">.</span>data<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">initData</span><span class="token punctuation">(</span>vm<span class="token punctuation">)</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token function">observe</span><span class="token punctuation">(</span>vm<span class="token punctuation">.</span>_data <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token boolean">true</span> <span class="token comment">/* asRootData */</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>opts<span class="token punctuation">.</span>computed<span class="token punctuation">)</span> <span class="token function">initComputed</span><span class="token punctuation">(</span>vm<span class="token punctuation">,</span> opts<span class="token punctuation">.</span>computed<span class="token punctuation">)</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>opts<span class="token punctuation">.</span>watch <span class="token operator">&amp;&amp;</span> opts<span class="token punctuation">.</span>watch <span class="token operator">!==</span> nativeWatch<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">initWatch</span><span class="token punctuation">(</span>vm<span class="token punctuation">,</span> opts<span class="token punctuation">.</span>watch<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p><strong>callHook(vm, 'created')</strong></p> <p>mount</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> mount <span class="token operator">=</span> <span class="token class-name">Vue</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>$mount
<span class="token class-name">Vue</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">$mount</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>
  <span class="token parameter">el<span class="token operator">?</span><span class="token punctuation">:</span> string <span class="token operator">|</span> Element<span class="token punctuation">,</span>
  hydrating<span class="token operator">?</span><span class="token punctuation">:</span> boolean</span>
<span class="token punctuation">)</span><span class="token punctuation">:</span> Component <span class="token punctuation">{</span>
  el <span class="token operator">=</span> el <span class="token operator">&amp;&amp;</span> <span class="token function">query</span><span class="token punctuation">(</span>el<span class="token punctuation">)</span>
  <span class="token keyword">const</span> options <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>$options
  <span class="token comment">// resolve template/el and convert to render function</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>options<span class="token punctuation">.</span>render<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token operator">...</span>
    <span class="token comment">// 如果不存在 render 函数，则会将模板转换成render函数</span>
    <span class="token keyword">const</span> <span class="token punctuation">{</span> render<span class="token punctuation">,</span> staticRenderFns <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">compileToFunctions</span><span class="token punctuation">(</span>template<span class="token punctuation">,</span> <span class="token punctuation">{</span>
      shouldDecodeNewlines<span class="token punctuation">,</span>
      delimiters<span class="token punctuation">:</span> options<span class="token punctuation">.</span>delimiters<span class="token punctuation">,</span>
      comments<span class="token punctuation">:</span> options<span class="token punctuation">.</span>comments
    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">)</span>
    options<span class="token punctuation">.</span>render <span class="token operator">=</span> render
    options<span class="token punctuation">.</span>staticRenderFns <span class="token operator">=</span> staticRenderFns
    <span class="token operator">...</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// 调用$mount方法</span>
  <span class="token keyword">return</span> <span class="token function">mount</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> el<span class="token punctuation">,</span> hydrating<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><p><strong>callHook(vm, 'beforeMount')</strong> <strong>callHook(vm, 'mounted')</strong></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">mountComponent</span> <span class="token punctuation">(</span>
  <span class="token parameter">vm<span class="token punctuation">:</span> Component<span class="token punctuation">,</span>
  el<span class="token punctuation">:</span> <span class="token operator">?</span>Element<span class="token punctuation">,</span>
  hydrating<span class="token operator">?</span><span class="token punctuation">:</span> boolean</span>
<span class="token punctuation">)</span><span class="token punctuation">:</span> Component <span class="token punctuation">{</span>
  vm<span class="token punctuation">.</span>$el <span class="token operator">=</span> el

  <span class="token comment">// 如果不存在render函数，则直接创建一个空的VNode节点</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>vm<span class="token punctuation">.</span>$options<span class="token punctuation">.</span>render<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    vm<span class="token punctuation">.</span>$options<span class="token punctuation">.</span>render <span class="token operator">=</span> createEmptyVNode
    <span class="token operator">...</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// 检测完render后，开始调用beforeMount声明周期</span>
  <span class="token function">callHook</span><span class="token punctuation">(</span>vm<span class="token punctuation">,</span> <span class="token string">'beforeMount'</span><span class="token punctuation">)</span>

  <span class="token keyword">let</span> updateComponent
  <span class="token comment">/* istanbul ignore if */</span>

  <span class="token function-variable function">updateComponent</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    vm<span class="token punctuation">.</span><span class="token function">_update</span><span class="token punctuation">(</span>vm<span class="token punctuation">.</span><span class="token function">_render</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> hydrating<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// 这里是上面所说的观察者，这里注意第二个expOrFn参数是一个函数</span>
  <span class="token comment">// 会在new Watcher的时候通过get方法执行一次</span>
  <span class="token comment">// 也就是会触发第一次Dom的更新</span>
  vm<span class="token punctuation">.</span>_watcher <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Watcher</span><span class="token punctuation">(</span>vm<span class="token punctuation">,</span> updateComponent<span class="token punctuation">,</span> noop<span class="token punctuation">)</span>
  hydrating <span class="token operator">=</span> <span class="token boolean">false</span>

  <span class="token comment">// manually mounted instance, call mounted on self</span>
  <span class="token comment">// mounted is called for render-created child components in its inserted hook</span>
  <span class="token comment">// 触发$mount函数</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>vm<span class="token punctuation">.</span>$vnode <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    vm<span class="token punctuation">.</span>_isMounted <span class="token operator">=</span> <span class="token boolean">true</span>
    <span class="token function">callHook</span><span class="token punctuation">(</span>vm<span class="token punctuation">,</span> <span class="token string">'mounted'</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> vm
<span class="token punctuation">}</span>
</code></pre></div><p>destroy</p> <p><strong>callHook(vm, 'beforeDestroy')</strong> <strong>callHook(vm, 'destroyed')</strong></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token class-name">Vue</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">$destroy</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> vm<span class="token punctuation">:</span> Component <span class="token operator">=</span> <span class="token keyword">this</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>vm<span class="token punctuation">.</span>_isBeingDestroyed<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span>
    <span class="token punctuation">}</span>
    <span class="token function">callHook</span><span class="token punctuation">(</span>vm<span class="token punctuation">,</span> <span class="token string">'beforeDestroy'</span><span class="token punctuation">)</span>
    vm<span class="token punctuation">.</span>_isBeingDestroyed <span class="token operator">=</span> <span class="token boolean">true</span>
    <span class="token comment">// remove self from parent</span>
    <span class="token keyword">const</span> parent <span class="token operator">=</span> vm<span class="token punctuation">.</span>$parent
    <span class="token keyword">if</span> <span class="token punctuation">(</span>parent <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>parent<span class="token punctuation">.</span>_isBeingDestroyed <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>vm<span class="token punctuation">.</span>$options<span class="token punctuation">.</span>abstract<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">remove</span><span class="token punctuation">(</span>parent<span class="token punctuation">.</span>$children<span class="token punctuation">,</span> vm<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// teardown watchers</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>vm<span class="token punctuation">.</span>_watcher<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      vm<span class="token punctuation">.</span>_watcher<span class="token punctuation">.</span><span class="token function">teardown</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">let</span> i <span class="token operator">=</span> vm<span class="token punctuation">.</span>_watchers<span class="token punctuation">.</span>length
    <span class="token keyword">while</span> <span class="token punctuation">(</span>i<span class="token operator">--</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      vm<span class="token punctuation">.</span>_watchers<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">teardown</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// remove reference from data ob</span>
    <span class="token comment">// frozen object may not have observer.</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>vm<span class="token punctuation">.</span>_data<span class="token punctuation">.</span>__ob__<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      vm<span class="token punctuation">.</span>_data<span class="token punctuation">.</span>__ob__<span class="token punctuation">.</span>vmCount<span class="token operator">--</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// call the last hook...</span>
    vm<span class="token punctuation">.</span>_isDestroyed <span class="token operator">=</span> <span class="token boolean">true</span>
    <span class="token comment">// invoke destroy hooks on current rendered tree</span>
    vm<span class="token punctuation">.</span><span class="token function">__patch__</span><span class="token punctuation">(</span>vm<span class="token punctuation">.</span>_vnode<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span>
    <span class="token comment">// fire destroyed hook</span>
    <span class="token function">callHook</span><span class="token punctuation">(</span>vm<span class="token punctuation">,</span> <span class="token string">'destroyed'</span><span class="token punctuation">)</span>
    <span class="token comment">// turn off all instance listeners.</span>
    vm<span class="token punctuation">.</span><span class="token function">$off</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token comment">// remove __vue__ reference</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>vm<span class="token punctuation">.</span>$el<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      vm<span class="token punctuation">.</span>$el<span class="token punctuation">.</span>__vue__ <span class="token operator">=</span> <span class="token keyword">null</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// release circular reference (#6759)</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>vm<span class="token punctuation">.</span>$vnode<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      vm<span class="token punctuation">.</span>$vnode<span class="token punctuation">.</span>parent <span class="token operator">=</span> <span class="token keyword">null</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>int Events &amp; lifecycle  合并父组件事件</p> <p>beforeCreate</p> <p>init injections &amp; reactivity  初始化并设置 props data computed watch methods</p> <p>created</p> <p>编译成render函数</p> <p>beforeMount</p> <p>挂载根节点</p> <p>mounted</p> <p>beforedestroy</p> <p>destroy</p></div> <div class="page-edit"><!----> <!----></div> <!----> </div> <!----></div></div>
    <script src="/knowledge-structure/assets/js/app.4b2130d8.js" defer></script><script src="/knowledge-structure/assets/js/95.c251cdc2.js" defer></script>
  </body>
</html>
