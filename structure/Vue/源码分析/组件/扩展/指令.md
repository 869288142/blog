# 指令

## 场景

Vue推崇数据驱动视图，而不是直接操作DOM，为了处理一些可复用的DOM逻辑，提供了指令这样的复用机制

## 基本语法

```js
Vue.directive('name', {
  hook() {
    doSomething
  }
})

// 使用v-name
```

### hook

* **bind**：只调用一次，指令第一次绑定到元素时调用。在这里可以进行一次性的初始化设置。

* **inserted**：被绑定元素插入父节点时调用 (仅保证父节点存在，但不一定已被插入文档中)。

* **update**：所在组件的 VNode 更新时调用，但是可能发生在其子 VNode 更新之前。指令的值可能发生了改变，也可能没有。但是你可以通过比较更新前后的值来忽略不必要的模板更新 

* **componentUpdated**：指令所在组件的 VNode 及其子 VNode 全部更新后调用。

* **unbind**：只调用一次，指令与元素解绑时调用。

### hook函数传入参数

* **el** 指令作用的DOM
* **binding** 对象
* **vnode** 编译生成的虚拟节点
* **oldVnode** 编译生成的旧节点


**bind对象**

```js
{
  name 指令名称 不包含v-前缀 

  arg 指令参数 *

  modifiers 修饰符对象 *

  expression 指令表达式字符串形式 *

  value 指令绑定值 *
}
```

## 设计理念

* 将脏DOM操作封装到指令中

* 自动提供DOM的生命周期来避免维护事件状态

## 源码分析

指令主要价值点在于指令提供的hook机制如何实现