# http2、http3一览

## http2

`http2`致力于解决`http1.x`的连接无法复用，队首阻塞等问题

### 二进制分帧层

HTTP/2 所有性能增强的核心在于新的二进制分帧层，它定义了如何封装 HTTP 消息并在客户端与服务器之间传输

![](./binary_framing_layer01.svg)

这里所谓的“层”，指的是**位于套接字接口与应用可见的高级 HTTP API 之间一个经过优化的新编码机制**：`HTTP/1.x` 协议以换行符作为纯文本的分隔符，而 `HTTP/2` 将所有传输的信息分割为更小的消息和帧，并采用二进制格式对它们编码,**一句话就就是`HTTP/1.x`是文本传输的，`HTTP/2`是基于二进制传输的，之所以不叫`http1.2`，也是因为新的编码方式与旧编码方式不兼容导致的**


### 数据流、消息和帧

新的二进制分帧机制改变了客户端与服务器之间交换数据的方式，有以下**重要概念**：

* `数据流`：已建立的连接内的双向字节流，可以承载一条或多条消息。
* `消息`：与逻辑请求或响应消息对应的完整的一系列帧。
* `帧`：`HTTP/2` 通信的最小单位，每个帧都包含帧头，至少也会标识出当前帧所属的数据流。


`HTTP/2` 中，同域名下所有通信都在单个连接上完成，该连接可以承载任意数量的双向数据流。每个数据流都以消息的形式发送，而消息又由一个或多个帧组成。多个帧之间可以乱序发送，根据帧首部的流标识可以重新组装。**将 HTTP 消息分解为独立的帧，交错发送，然后在另一端重新组装是 HTTP 2 最重要的一项增强**

### 多路复用

可以打开[此链接](https://http2.akamai.com/demo)对比`http2`和`http1.x`的速度提升


HTTP/2 中新的二进制分帧层突破了`http1.x`限制，实现了完整的请求和响应复用：**客户端和服务器可以将 HTTP 消息分解为互不依赖的帧，然后交错发送，最后再在另一端把它们重新组装起来。**

### 数据优先级

在`http1.x`中先请求的资源具有最高的优先级，在`http2`中由于没有了阻塞问题，优先级已经不是由请求顺序确定，`http2`采用了优先级树的优先级策略,从之前前端决定资源优先级移到了后台决定资源的优先级

* 可以向每个数据流分配一个介于 1 至 256 之间的整数。

* 每个数据流与其他数据流之间可以存在显式依赖关系。


### 头部压缩

`HTTP/2` 使用 [HPACK](https://tools.ietf.org/html/draft-ietf-httpbis-header-compression-12) 压缩格式压缩请求和响应标头元数据，这种格式采用两种简单但是强大的技术：

1. 这种格式支持通过静态霍夫曼代码对传输的标头字段进行编码，从而减小了各个传输的大小。

2. 这种格式要求客户端和服务器同时维护和更新一个包含之前见过的标头字段的索引列表（换句话说，它可以建立一个共享的压缩上下文）

简单来说就是**采用了编码减少了传输大小，同时可以通过索引表减少重复的传输字段**

### 服务器推送

服务器可以对一个客户端请求发送多个响应。 换句话说，除了对最初请求的响应外，服务器还可以向客户端推送额外资源，**比如说请求index.html,我们还可以同时把css、js一起传输过去**

### http2缺点

#### 缺点

* 优先级控制有点困难，特别是在`CDN`环境下

* 目前主流浏览器都只支持SSL的HTTP2的协议

* 服务器推送时，在浏览器发送拒绝信号前，已经把资源推送到浏览器了

### 移除针对HTTP/1.x的优化

* 域名分片，减少不必要的请求

* 雪碧图，可以减少渲染内存，和不必要的css代码

* 资源合并，资源可以按需加载，不需要再合并成一个大的

## http3

`http2`还是没能解决`TCP`连接上的阻塞问题,丢包情况下，反而会比`http1.x`表现更差

### 特性


* 0-RTT

* 多路复用，几乎无队头阻塞

* 协议级别的加密，加密认证的报文

* 向前纠错机制,可以根据已有的包计算出丢失的包，按照这个大小去请求丢失的包






## 参考资料

[HTTP/2 简介HTTP/2 简介](https://developers.google.com/web/fundamentals/performance/http2?hl=zh-cnhttps://developers.google.com/web/fundamentals/performance/http2?hl=zh-cn)

[HTTP2 详解](https://juejin.im/post/6844903667569541133#heading-38)

[HTTP/2特性及其在实际应用中的表现](https://zhuanlan.zhihu.com/p/30166894)

[QUIC协议原理分析](https://zhuanlan.zhihu.com/p/32553477)