# URL编码

## 原因

一些字符会引起歧义，需要特殊机制表示它们的含义，转义字符就是一个常见的方法，把源字符转义这一过程被称为编码，反过程被称为解码，**这个过程注意点是知道哪些字符需要转义的，下面根据规范展开这部分**

## 保留字符与未保留字符

[RFC3986文档规定(第二章字符)，Url中只允许包含未保留字符以及所有保留字符。](https://datatracker.ietf.org/doc/rfc3986/?include_text=1)

**保留字符**

保留字符 | 含义 | 例子  
-|-|-
: / ? # [] @ | 分隔Url的协议、主机、路径等组件。比如：冒号:保留为方案、用户/口令，以及主机/端口组件的定界符使用；/保留为路径组件中分隔路径段的定界符；? 保留作为查询字符串定界符使用；#保留为分段定界符使用 | encodeURI(' : / ? # []  @')  ": / ?#%5B%5D@"其中[]被转义，因为它们是不安全字符 |
!$&'()*+,;= | 用于在每个组件中起到分隔作用的。比如：&符号用于分隔查询多个键值对；=用于表示查询参数中的键值对。 | encodeURI("! $ \& ' () * + ,; =") // "!$&'()*+,;=" |


**未保留字符**

英文字母（a-zA-Z）、数字（0-9）、-_.~ 4个特殊字符

**未保留字符不需要编码**

**小结**

保留字符是指用作特殊用途，而未保留字符是指规范允许使用但是没纳入规范

## 需要编码的字符

受限字符 | 为何受限 |  例子  
-|-|-
% | 作为编码字符的转义标志，因此本身需要编码 | encodeURI('%') // "%25" 
空格 | Url在传输的过程，或者用户在排版的过程，或者文本处理程序在处理Url的过程，都有可能引入无关紧要的空格，或者将那些有意义的空格给去掉。 | encodeURI(' ') // "%20" 
<>" | 尖括号和引号通常用于在普通文本中起到分隔Url的作用，所以应该对其进行编码 | encodeURI('<>"') // "%3C%3E%22" 
{}\|\^~[]' | 某一些网关或者传输代理会篡改这些字符。你可能会感到奇怪，为什么使用一些不安全字符的时候并没有发生什么不好的事情，比如无需对~字符进行编码，前面也说了，对某些传输协议来说不是问题。| encodeURI("{}|\^~[]'") // "%7B%7D&%7C%5E~%5B%5D'" 
0x00-0x1F, 0x7F | 受限，这些十六进制范围内的字符都在US-ASCII字符集的不可打印区间内 | 比如换行键是0x0A 
\>0x7F | 受限，十六进制值在此范围内的字符都不在US-ASCII字符集的7比特范围内 | encodeURI('京东') // "%E4%BA%AC%E4%B8%9C"

## 内置编码方法

* escape unescape 

  此解码/编码方法已经从Web标准中删除，不再推荐使用

  字符的16进制格式值,当该值小于等于0xFF时,用一个2位转移序列: %xx 表示. 大于的话则使用4位序列:%uxxxx 表示，而新的编码方法统一表示成URL编码（UTF-8）

```js
escape("中")
// "%u4E2D"
encodeURI("中")
// "%E4%B8%AD"
```

### encodeURI与encodeURIComponent 区别

encodeURIComponent 假定参数是 URI 的一部分（比如协议、主机名、路径或查询字符串）。因此 encodeURIComponent() 函数将转义用于分隔 URI 各个部分的标点符号（; / ?: @&=+$,#），所以encodeURIComponent的不编码集只有71个，此时URI由于分割URI的标点符号被转义，会导致此URL无法使用

```js
encodeURIComponent('https://aotu.io/')
// "https%3A%2F%2Faotu.io%2F"  此时无法访问

encodeURI('https://aotu.io/')
// "https://aotu.io/"
```

所以encodeURI由于编码URL整体，而encodeURIComponent用于编码URL局部，这个局部的判定就是需要转义的部分


## 总结

encodeURI可以用于对整个URI进行编码，而encodeURIComponent只对于URI局部歧义部分进行编码